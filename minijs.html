<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=windows-1252">
		<title>Top Down Operator Precedence</title>
		<link rel="stylesheet" href="bootstrap.min.css">
		<link rel="stylesheet" href="style.css">
		<style>

		</style>
</head>

<body>
<h1>Top Down Operator Precedence</h1>

<p>This is the companion file to my paper on <a href="http://javascript.crockford.com/tdop/tdop.html">Vaughan
  Pratt's Top Down Operator Precedence</a>. The paper presents a parser
  for Simplified JavaScript that is written in Simplified Javascript. It
  is chapter 9 of <a href="http://www.amazon.com/exec/obidos/ASIN/0596510047/wrrrldwideweb">Beautiful
  Code</a>. This page loads that parser and runs the parser on itself. </p>
  
<p>This page loads two JavaScript files:</p>
<table align="center">
	<tr>
		<td><a href="http://javascript.crockford.com/tdop/tokens.js">tokens.js</a>
		<td>This file installs the <code>String.prototype.tokens</code> method. It produces an array of simple tokens from a string.
	<tr>
		<td><a href="http://javascript.crockford.com/tdop/parse.js">parse.js</a>
		<td>This file installs the <code>make_parse</code> function which produces the parse function. The indirection was done so that we could conveniently recover the source of the function.
</table>

<p>The text that follows is the parse tree that the parser generated by parsing itself.</p>
<textarea id="minijs_INPUT">var a = 1 + 2;</textarea>
<input id="PARSE" value="parse" type="button">
<script src="minijs_tokens.js"></script>
<script src="minijs_parse.js"></script>
<pre id="OUTPUT"></pre>
<script>
	// Transform a token object into an exception object and throw it.
	Object.prototype.error = function (message, t) {
		t = t || this;
		t.name = "SyntaxError";
		t.message = message;
		throw t;
	};

    var parser = new Parser();

    function go(source) {
        var string, tree;
        try {
            tree = parser.parse(source);
            string = JSON.stringify(tree, ['key', 'name', 'message',
                'value', 'arity', 'first', 'second', 'third', 'fourth'], 4);
        } catch (e) {
            string = JSON.stringify(e, ['name', 'message', 'from', 'to', 'key',
                    'value', 'arity', 'first', 'second', 'third', 'fourth'], 4);
        }
        document.getElementById('OUTPUT').innerHTML = string
            .replace(/&/g, '&amp;')
            .replace(/[<]/g, '&lt;');
    }

    //go("var make_parse = " + make_parse.toSource() + ";");
	go(input());
	
	function input() {
		return document.getElementById('minijs_INPUT').value;
	}
	
    document.getElementById('PARSE').onclick = function (e) {
        go(input());
    };


</script>


</body></html>